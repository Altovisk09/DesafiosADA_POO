<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>canvas</title>
    <link rel="stylesheet" href="./canva.css">
</head>

<body>
    <canvas id="desenho1" width="878" height="500" style="border: 1px solid #000;">
        Seu navegador não é compatível com o canvas.
    </canvas>
    <script>
        let canvas = document.getElementById('desenho1');
        let ctx = canvas.getContext('2d');

        let human = new Image();
        human.src = './char_a_p1_0bas_humn_v01.png';
        let px = 0;
        let py = 0;
        let numSprite = 0;
        let colunSprite;
        let posIniX = 0;
        let posIniY = 0;
        let SpriteX = 8;
        let SpriteY = 8;
        let velocidade = 5;
        let direita = false, esquerda = false, cima = false, baixo = false;

        human.addEventListener('load', () => {
            let largImg = human.width;
            let altImg = human.height;
            let largSprite = largImg / SpriteX;
            let altSprite = altImg / SpriteY;

            function desenhar() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                posIniY = colunSprite * altSprite;
                posIniX = numSprite * largSprite;

                //imagem XiniR YiniR LargRecorte Altrecorte posX posY LargImagem AltImagem
                ctx.drawImage(human, posIniX, posIniY, largSprite, altSprite, px, py, 150, 150);
                console.log(`px:${px} \npy:${py}\n\n width:${largSprite}\n height:${altSprite}` )
            }
            desenhar()
            function animacao() {
                cWidth = canvas.width;
                cHeigth = canvas.height;
            
            altSprite
                if (direita) {
                    px += velocidade;
                    numSprite++
                    if (numSprite >= 5) {
                        numSprite = 0;
                    }
                    if(px + largSprite >= cWidth - 36){
                        px = cWidth - largSprite - 36
                    }
                } else if (esquerda) {
                    px -= velocidade;
                    numSprite++
                    if (numSprite >= 5) {
                        numSprite = 0;
                    }
                     if (px <= -54) {
                         px = -54;
                     }
                }
                if (cima) {
                    py -= velocidade;

                    numSprite++
                    if (numSprite >= 5) {
                        numSprite = 0;
                    }
                    if (py <= -34) {
                         py = -34;
                     }
                } else if (baixo) {
                    py += velocidade;
                    numSprite++
                    if (numSprite >= 5) {
                        numSprite = 0;
                    }
                    if (py + altSprite >= cHeigth - 36) {
                        py = cHeigth - altSprite - 36;
                     }
                }
                desenhar();

                setTimeout(() => {
                    requestAnimationFrame(animacao);
                }, 50);
            }
            animacao();
        })

        window.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowRight') {
                direita = true;
                colunSprite = 6;

            } else if (event.key === 'ArrowLeft') {
                esquerda = true;
                colunSprite = 7;
            }
            if (event.key === 'ArrowUp') {
                cima = true;
                colunSprite = 5;
            } else if (event.key === 'ArrowDown') {
                baixo = true;
                colunSprite = 4;
            }
        })

        window.addEventListener('keyup', (event) => {
            if (event.key === 'ArrowRight') {
                direita = false;
            } else if (event.key === 'ArrowLeft') {
                esquerda = false;
            }
            if (event.key === 'ArrowUp') {
                cima = false;
            } else if (event.key === 'ArrowDown') {
                baixo = false;
            }
            if (!direita && !esquerda && !cima && !baixo) {
                colunSprite = 0;
                numSprite = 0;
            }
        })
    </script>
</body>

</html>